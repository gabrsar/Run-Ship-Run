<html>
<head>
  <title></title>
  <meta charset="utf-8"/>
  <style></style>
</head>
<body>
  <h1> Run Ship! Run!</h1>
  <div>
    <canvas id='canvas'></canvas>
  </div>
  <div>
    <canvas id='canvas2'>
    </canvas>
  </div>
</body>

<script type='text/javascript'>

// I have to give thanks to William Malone by the excelent tutorial at
// http://www.williammalone.com/articles/create-html5-canvas-javascript-sprite-animation/

var GAME_W = 500;
var GAME_H = 500;
var IMG_DIR = "./img/";

var coin;
var CTX;

function init(){
  var cvs = document.getElementById('canvas');
  CTX = cvs.getContext('2d');

  cvs.height=GAME_H;
  cvs.width=GAME_W;

  var coinSprite = new Image();
  coinSprite.src = IMG_DIR + "coin-anim.png";
  coinSprite.addEventListener("load",gameLoop);

  coin = sprite({context:CTX,x:0,y:0,width:25,height:25, image:coinSprite,numberOfFrames:24,ticksPerFrame:1,loop:1});
}




function gameLoop(){


  window.requestAnimationFrame(gameLoop);

  CTX.clearRect(0,0,GAME_W,GAME_H);

  var t = new Date();

  var ts = t.getSeconds();
  var tm = t.getMilliseconds();

  coin.x = 100+Math.cos(ts*5 + tm/200)*25;
  coin.y = 100+Math.sin(ts*5 + tm/200)*25;
  coin.update();
  coin.render();


}

function sprite(options) {

  var that = {},
      frameIndex = 0,
      tickCount = 0,
      ticksPerFrame = options.ticksPerFrame || 0,
      numberOfFrames = options.numberOfFrames || 1;

  that.context = options.context;
  that.width = options.width;
  that.height = options.height;
  that.image = options.image;
  that.loop = options.loop;
  that.x = options.x;
  that.y = options.y;


  that.render = function(){
    var ctx = that.context;


    // ctx.fillRect(that.x,that.y,that.width,that.height);
    ctx.drawImage(
      that.image,
      (frameIndex * that.width),
      0,
      that.width,
      that.height,
      that.x,
      that.y,
      that.width,
      that.height
    );
  };

  that.update = function(){
    tickCount += 1;

    if (tickCount > ticksPerFrame) {
      tickCount = 0;
      if(frameIndex < (numberOfFrames - 1)){
        frameIndex +=1;
      } else if (that.loop){
        frameIndex = 0;
      }
    }
  };

  return that;
}

init();

</script>
</html>
